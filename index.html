<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>GenX ‚Äî News Feed</title>
<style>
    /* --- General Layout & Navigation Styles --- */
    body {
        margin: 0;
        font-family: "Poppins", Arial, sans-serif;
        background: #f0f2f5;
    }
    .navbar {
        background-color: #1877f2;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        position: sticky;
        top: 0;
        z-index: 10;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
    .logo { font-size: 22px; font-weight: 700; }
    .menu-toggle { font-size: 28px; cursor: pointer; color: white; margin-left: 10px; }
    .nav-links {
        list-style: none;
        display: none;
        flex-direction: column;
        position: absolute;
        top: 60px;
        right: 0;
        width: 100%;
        background: white;
        border-top: 1px solid #ddd;
        padding: 10px 0;
        text-align: center;
        z-index: 999;
    }
    .nav-links li { margin: 10px 0; }
    .nav-links a { color: #333; text-decoration: none; font-weight: 600; }
    .nav-links a:hover { color: #1877f2; }
    .nav-links.active { display: flex; }
    @media (min-width: 768px) {
        .menu-toggle { display: none; }
        .nav-links {
            display: flex !important;
            flex-direction: row;
            position: static;
            background: none;
            border: none;
        }
        .nav-links li { margin: 0 10px; }
        .nav-links a { color: white; }
        .nav-links a:hover { text-decoration: underline; }
    }
    /* Search Bar */
    .search-bar { flex: 1; display: flex; justify-content: center; align-items: center; margin: 0 15px; position: relative; }
    .search-bar input {
        width: 100%; max-width: 320px;
        padding: 8px 36px 8px 14px;
        border-radius: 25px;
        border: none;
        outline: none;
        font-size: 14px;
        background: white;
        color: #333;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .search-bar::after { content: "üîç"; position: absolute; right: 15px; top: 50%; transform: translateY(-50%); font-size: 15px; color: #666; }
    .search-results {
        position: absolute; top: 42px; width: 100%; max-width: 320px; background: white; border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15); overflow: hidden; z-index: 1000; display: none;
    }
    .search-results.active { display: block; }
    .search-results div { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; font-size: 14px; }
    .search-results div:hover { background: #f0f2f5; }
    .category { background: #f7f7f7; font-weight: bold; color: #1877f2; text-transform: uppercase; font-size: 12px; }
    /* --- Feed & Post Styles --- */
    .feed { max-width: 600px; margin: 20px auto; }
    .post { background: white; margin-bottom: 15px; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .post-header { font-weight: bold; color: #1877f2; display: flex; justify-content: space-between; align-items: center; }
    .post-time { color: gray; font-size: 12px; }
    .post-text { margin: 10px 0; white-space: pre-wrap; font-size: 15px; }
    .post img { 
        width: 100%; 
        height: auto; 
        max-height: 400px; 
        object-fit: cover; 
        margin-top: 10px; 
        border-radius: 10px; 
        background-color: #eee;
    }
    .actions { margin-top: 10px; display: flex; gap: 10px; border-top: 1px solid #eee; padding-top: 10px; }
    .actions button { 
        background: none; border: none; color: #555; 
        cursor: pointer; font-weight: 600; padding: 8px 12px;
        border-radius: 5px; transition: background-color 0.2s;
        display: flex; align-items: center; gap: 5px;
    }
    .actions button:hover { background: #f0f2f5; }
    .actions button.liked { color: #1877f2; font-weight: bold; }
    .no-posts { text-align: center; color: #888; padding: 30px; }
    /* --- Comment Section Styles --- */
    .comments-section { margin-top: 10px; border-top: 1px solid #ddd; padding-top: 10px; }
    .comments-list { max-height: 150px; overflow-y: auto; margin-bottom: 10px; }
    .comment-item {
        background: #f0f2f5; border-radius: 10px; padding: 6px 10px;
        margin-bottom: 6px; font-size: 14px; color: #050505;
        word-wrap: break-word; white-space: normal;
    }
    .comment-input { display: flex; gap: 6px; }
    .comment-input input[type="text"] {
        flex-grow: 1; padding: 6px 12px; border-radius: 20px;
        border: 1px solid #ccc; font-size: 14px;
    }
    .comment-input button {
        background-color: #1877f2; border: none; color: white;
        border-radius: 20px; padding: 6px 16px; cursor: pointer;
        font-weight: bold; font-size: 14px; width: auto;
    }
    .comment-input button:hover { background-color: #155db2; }
</style>
</head>

<body>
    <nav class="navbar">
        <div class="logo">GenX</div>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search profiles, posts, pages..." />
            <div class="search-results" id="searchResults"></div>
        </div>
        <div class="menu-toggle" id="menu-toggle">‚ò∞</div>
        <ul class="nav-links" id="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="authentication.html">Signup/Login</a></li>
            <li><a href="profile.html">Profile</a></li>
            <li><a href="groups.html">Groups</a></li>
            <li><a href="friends.html">Friendship</a></li>
            <li><a href="chat.html">Chats</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="services.html">Services</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="settings.html">Settings</a></li>
        </ul>
    </nav>
    <div class="feed" id="feedContainer">
        <div class="no-posts">Loading posts...</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. Navigation and Search Logic ---
            const menuToggle = document.getElementById('menu-toggle');
            const navLinks = document.getElementById('nav-links');
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
            });

            const data = {
                users: ["Milan Kandel", "Sita Rai", "John Smith", "Aarav Shrestha"],
                pages: ["Digital Nepal", "GenX Official", "Smart Investments", "Real Estate Hub"],
                groups: ["Nepal Tech Group", "Bara Entrepreneurs", "Students Network"],
                posts: ["How to grow your business online","New real estate projects in Nepal","GenX live streaming feature","Tips for investment success"]
            };
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');

            searchInput.addEventListener('input', () => {
                const query = searchInput.value.toLowerCase();
                searchResults.innerHTML = "";
                if (!query.trim()) return searchResults.classList.remove('active');
                let resultsHTML = "";

                for (const category in data) {
                    const filtered = data[category].filter(item => item.toLowerCase().includes(query));
                    if (filtered.length) {
                        resultsHTML += `<div class="category">${category}</div>`;
                        filtered.forEach(item => resultsHTML += `<div>${item}</div>`);
                    }
                }

                searchResults.innerHTML = resultsHTML || `<div>No results found</div>`;
                searchResults.classList.add('active');
            });

            document.addEventListener('click', e => { if (!e.target.closest('.search-bar')) searchResults.classList.remove('active'); });

            
            // --- 2. Post Data Initialization ---
            const feedContainer = document.getElementById('feedContainer');
            const DEFAULT_USER = { name: 'Rajan Kandel' };
            const currentUserProfile = JSON.parse(localStorage.getItem('userProfile')) || DEFAULT_USER;
            const currentUserName = currentUserProfile.name || DEFAULT_USER.name;

            // Load posts from local storage or initialize an empty array
            let posts = JSON.parse(localStorage.getItem('fbPosts')) || [];

            function generateMockPosts() {
                // Only create mock data if storage is empty
                if (posts.length > 0) return; 

                const mockContent = [
                    { text: "Just had a great trip to the mountains! The view was incredible. ‚õ∞Ô∏è", author: "Sita Rai", privacy: "public" },
                    { text: "Learning JavaScript today. This is the future of web dev! #coding", author: "John Smith", privacy: "public" },
                    { text: "New investment strategy is paying off! Check out my profile for details.", author: "Aarav Shrestha", privacy: "public" },
                    { text: "My personal private thought for today. (Should not appear in other users' feeds)", author: "Aarav Shrestha", privacy: "onlyme" },
                    { text: "Excited for the GenX update next week!", author: "Sita Rai", privacy: "public" }
                ];

                mockContent.forEach((item, index) => {
                    posts.push({
                        id: Date.now() + index,
                        text: item.text,
                        image: null,
                        likes: Math.floor(Math.random() * 50) + 1,
                        liked: false,
                        comments: (index === 1) ? [`${currentUserName}: Great post!`, "Keep learning!"] : [],
                        authorName: item.author,
                        privacy: item.privacy,
                        timestamp: Date.now() - (index * 3600000)
                    });
                });

                localStorage.setItem('fbPosts', JSON.stringify(posts));
                console.log("Mock posts generated because storage was empty.");
            }
            
            // Run mock generation at startup
            generateMockPosts();

            function saveAndRender() {
                localStorage.setItem('fbPosts', JSON.stringify(posts));
                renderPosts();
            }

            // --- 3. Rendering and Event Listener Logic ---

            function renderComments(postIndex, container) {
                container.innerHTML = '';
                const comments = posts[postIndex].comments || [];
                if (comments.length === 0) {
                    container.innerHTML = '<em>No comments yet</em>';
                    return;
                }
                comments.forEach(comment => {
                    const div = document.createElement('div');
                    div.className = 'comment-item';
                    div.textContent = comment;
                    container.appendChild(div);
                });
            }

            function renderPosts() {
                feedContainer.innerHTML = "";
                let hasVisiblePosts = false;

                // Sorting by time: newest post first
                const sortedPosts = [...posts].sort((a, b) => b.timestamp - a.timestamp);¬†

                sortedPosts.forEach((post) => {
                    // APPLY PRIVACY FILTER
                    let isVisible = false;
                    
                    if (post.privacy === 'public') {
                        isVisible = true;
                    } else if (post.privacy === 'friends') {
                        // In this simple setup, 'friends' posts are only visible to the author.
                        // In a real app, this would check if currentUserName is in the author's friend list.
                        if (post.authorName === currentUserName) {
                            isVisible = true;
                        }
                    } else if (post.privacy === 'onlyme') {
                        if (post.authorName === currentUserName) {
                            isVisible = true;
                        }
                    }

                    if (!isVisible) return; // Skip posts that don't pass the visibility check
                    
                    hasVisiblePosts = true;
                    // Find the original index for saving changes (likes/comments)
                    const originalIndex = posts.findIndex(p => p.id === post.id);
                    if (originalIndex === -1) return;¬†

                    const postDiv = document.createElement('div');
                    postDiv.classList.add('post');

                    const likedClass = post.liked ? 'liked' : '';
                    const commentsCount = post.comments ? post.comments.length : 0;
                    // Format the time as a readable string
                    const postDate = new Date(post.timestamp || Date.now()).toLocaleString();¬†

                    postDiv.innerHTML = `
                        <div class="post-header">
                            <span>${post.authorName || 'Unknown'}</span>
                            <span style="font-size:12px;color:gray;">${post.privacy || 'public'}</span>
                        </div>
                        <div class="post-time">Posted at ${postDate}</div>
                        <p class="post-text">${post.text || ''}</p>
                        ${post.image ? `<img src="${post.image}" alt="Post Image">` : ''}
                        
                        <div class="actions">
                            <button class="like-btn ${likedClass}" data-index="${originalIndex}">
                                ${posts[originalIndex].liked ? '‚ù§Ô∏è' : 'üëç'} <span class="like-count">${posts[originalIndex].likes}</span> Like
                            </button>
                            <button class="comment-toggle-btn" data-index="${originalIndex}">
                                üí¨ Comment (${commentsCount})
                            </button>
                            <button class="share-btn" data-index="${originalIndex}">üîó Share</button>
                        </div>

                        <div class="comments-section" style="display:none;" data-index="${originalIndex}">
                            <div class="comments-list"></div>
                            <div class="comment-input">
                                <input type="text" placeholder="Write a comment..." />
                                <button class="send-comment-btn" data-index="${originalIndex}">Send</button>
                            </div>
                        </div>
                    `;
                    feedContainer.appendChild(postDiv);
                });

                if (!hasVisiblePosts) {
                    feedContainer.innerHTML = '<div class="no-posts">No public posts found. Start a conversation!</div>';
                }

                attachEventListeners();
            }

            function attachEventListeners() {
                document.querySelectorAll('.like-btn').forEach(btn => {
                    btn.onclick = function() {
                        const idx = parseInt(this.getAttribute('data-index'));
                        posts[idx].liked = !posts[idx].liked;
                        posts[idx].likes += posts[idx].liked ? 1 : -1;
                        saveAndRender();
                    };
                });
                document.querySelectorAll('.comment-toggle-btn').forEach(btn => {
                    btn.onclick = function() {
                        const idx = parseInt(this.getAttribute('data-index'));
                        const commentsSection = this.closest('.post').querySelector(`.comments-section`);
                        if (!commentsSection) return;
                        commentsSection.style.display = commentsSection.style.display === 'block' ? 'none' : 'block';
                        if (commentsSection.style.display === 'block') {
                            renderComments(idx, commentsSection.querySelector('.comments-list'));
                        }
                    };
                });
                document.querySelectorAll('.send-comment-btn').forEach(btn => {
                    btn.onclick = function() {
                        const idx = parseInt(this.getAttribute('data-index'));
                        const section = this.closest('.comments-section');
                        const input = section.querySelector('input[type="text"]');
                        if (!input.value.trim()) return;
                        const posterName = currentUserName;
                        const fullComment = `${posterName}: ${input.value.trim()}`;
                        if (!posts[idx].comments) posts[idx].comments = [];
                        posts[idx].comments.push(fullComment);
                        input.value = '';
                        saveAndRender();
                        setTimeout(() => {
                            const newCommentsSection = document.querySelector(`.post:has([data-index="${idx}"]) .comments-section`);
                            if (newCommentsSection) {
                                newCommentsSection.style.display = 'block';
                                renderComments(idx, newCommentsSection.querySelector('.comments-list'));
                            }
                        }, 50);
                    };
                });
                document.querySelectorAll('.share-btn').forEach(btn => {
                    btn.onclick = function() {
                        const idx = parseInt(this.getAttribute('data-index'));
                        const shareText = `Check out this post by ${posts[idx].authorName}: "${posts[idx].text}"`;
                        navigator.clipboard.writeText(shareText).then(() => alert("Post copied to clipboard!"));
                    };
                });
            }

            // --- 4. Initialization ---
            renderPosts();
        });
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        const firebaseConfig = {
            apiKey: "AIzaSyAyMhgLjQg9zU1Tq2pFVmRiF_UiOBqPlj0",
            authDomain: "genx-7a5b3.firebaseapp.com",
            projectId: "genx-7a5b3",
            storageBucket: "genx-7a5b3.firebasestorage.app",
            messagingSenderId: "1293731877",
            appId: "1:1293731877:web:a330360ade1db5e68897cc"
        };
        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            console.log("Firebase initialized successfully.");
        } catch (error) {
            console.warn("Firebase initialization failed (likely local use).");
        }
    </script>
</body>
</html>