<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profile Page</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }
    .cover {
      height: 200px;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .profile {
      text-align: center;
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      position: relative;
    }
    .profile img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid white;
      margin-top: -60px;
    }
    .edit-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #1877f2;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
    }
    .post-form, .post {
      background: white;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      resize: vertical;
      margin-bottom: 10px;
      border: 1px solid #ccc;
    }
    .post-form input[type="file"] {
      margin-bottom: 10px;
    }
    .post-form button {
      background: #1877f2;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .post img, .post video {
      width: 100%;
      margin-top: 10px;
      border-radius: 8px;
    }
    .engagement button {
      margin-right: 10px;
      background: none;
      border: none;
      cursor: pointer;
      color: #555;
    }
    .preview img, .preview video {
      width: 100%;
      margin-top: 10px;
      border-radius: 8px;
    }
    .three-dots {
      position: absolute;
      right: 10px;
      top: 10px;
      cursor: pointer;
    }
    .post-options {
      display: none;
      position: absolute;
      right: 10px;
      top: 30px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .post-options button {
      display: block;
      background: none;
      border: none;
      padding: 10px;
      width: 100%;
      text-align: left;
      cursor: pointer;
    }
    .comment-section {
      margin-top: 10px;
    }
    .comment-section input {
      width: 80%;
      padding: 5px;
    }
    .comment {
      font-size: 0.9em;
      margin-top: 5px;
      padding-left: 10px;
      color: #333;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="cover">
    <img id="coverPic" src="https://via.placeholder.com/600x200" />
  </div>

  <div class="profile">
    <button class="edit-btn" onclick="window.location.href='authentication.html'">Edit Profile</button>
    <img id="profilePic" src="https://via.placeholder.com/100" />
    <h2 id="profileName">John Doe</h2>
    <p id="profileBio">Hello from the village!</p>
  </div>

  <div class="post-form">
    <textarea id="postText" placeholder="What's on your mind?" required></textarea>
    <input type="file" id="mediaInput" accept="image/*,video/*" />
    <div class="preview" id="mediaPreview"></div>
    <button onclick="createPost()">Post</button>
  </div>

  <div id="postsContainer"></div>
</div>

<script>
let mediaBase64 = "";

function loadProfile() {
  const data = JSON.parse(localStorage.getItem("profile")) || {
    name: "John Doe",
    bio: "Hello from the village!",
    profilePic: "https://via.placeholder.com/100",
    coverPic: "https://via.placeholder.com/600x200"
  };
  document.getElementById("profileName").innerText = data.name;
  document.getElementById("profileBio").innerText = data.bio;
  document.getElementById("profilePic").src = data.profilePic;
  document.getElementById("coverPic").src = data.coverPic;
}

document.getElementById("mediaInput").addEventListener("change", function () {
  const file = this.files[0];
  const preview = document.getElementById("mediaPreview");
  preview.innerHTML = "";
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      mediaBase64 = e.target.result;
      preview.innerHTML = file.type.startsWith("image/")
        ? `<img src="${mediaBase64}" />`
        : `<video controls src="${mediaBase64}"></video>`;
    };
    reader.readAsDataURL(file);
  }
});

function createPost() {
  const text = document.getElementById("postText").value.trim();
  if (text === "") return alert("Please write something!");
  const profile = JSON.parse(localStorage.getItem("profile")) || { name: "Anonymous" };
  const posts = JSON.parse(localStorage.getItem("posts") || "[]");
  posts.push({
    id: Date.now(),
    text,
    media: mediaBase64,
    type: mediaBase64.startsWith("data:video") ? "video" : "image",
    liked: false,
    likes: 0,
    comments: [],
    timestamp: new Date().toLocaleString(),
    author: profile.name
  });
  localStorage.setItem("posts", JSON.stringify(posts));
  document.getElementById("postText").value = "";
  document.getElementById("mediaInput").value = "";
  document.getElementById("mediaPreview").innerHTML = "";
  mediaBase64 = "";
  showPosts();
}

function likePost(id) {
  const posts = JSON.parse(localStorage.getItem("posts") || "[]");
  const post = posts.find(p => p.id === id);
  if (post) {
    post.liked = !post.liked;
    post.likes += post.liked ? 1 : -1;
    localStorage.setItem("posts", JSON.stringify(posts));
    showPosts();
  }
}

function addComment(id, inputId) {
  const commentText = document.getElementById(inputId).value.trim();
  if (!commentText) return;
  const posts = JSON.parse(localStorage.getItem("posts") || "[]");
  const post = posts.find(p => p.id === id);
  if (post) {
    post.comments.push(commentText);
    localStorage.setItem("posts", JSON.stringify(posts));
    showPosts();
  }
}

function editPost(id) {
  const newText = prompt("Edit your post:");
  if (!newText) return;
  const posts = JSON.parse(localStorage.getItem("posts") || "[]");
  const post = posts.find(p => p.id === id);
  if (post) {
    post.text = newText;
    localStorage.setItem("posts", JSON.stringify(posts));
    showPosts();
  }
}

function deletePost(id) {
  let posts = JSON.parse(localStorage.getItem("posts") || "[]");
  posts = posts.filter(p => p.id !== id);
  localStorage.setItem("posts", JSON.stringify(posts));
  showPosts();
}

function toggleOptions(id) {
  const menu = document.getElementById(`options-${id}`);
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}

function showPosts() {
  const posts = JSON.parse(localStorage.getItem("posts") || "[]");
  const container = document.getElementById("postsContainer");
  container.innerHTML = "";
  posts.slice().reverse().forEach(post => {
    const media = post.media
      ? post.type === "video"
        ? `<video controls src="${post.media}"></video>`
        : `<img src="${post.media}" />`
      : "";

    const commentsHtml = post.comments.map(c => `<div class="comment">üí¨ ${c}</div>`).join("");

    container.innerHTML += `
      <div class="post" style="position: relative">
        <div class="three-dots" onclick="toggleOptions(${post.id})">‚ãØ</div>
        <div class="post-options" id="options-${post.id}">
          <button onclick="editPost(${post.id})">Edit</button>
          <button onclick="deletePost(${post.id})">Delete</button>
        </div>
        <strong>${post.author}</strong>
        <p>${post.text}</p>
        ${media}
        <div class="engagement">
          <button onclick="likePost(${post.id})">
            ${post.liked ? "üíô Unlike" : "ü§ç Like"} (${post.likes})
          </button>
          <button onclick="document.getElementById('comment-box-${post.id}').style.display='block'">üí¨ Comment</button>
          <button onclick="alert('Shared!')">‚Üó Share</button>
        </div>
        <div id="comment-box-${post.id}" class="comment-section" style="display:none;">
          <input id="commentInput-${post.id}" placeholder="Write a comment..." />
          <button onclick="addComment(${post.id}, 'commentInput-${post.id}')">Send</button>
        </div>
        ${commentsHtml}
        <small>${post.timestamp}</small>
      </div>
    `;
  });
}

window.onload = () => {
  loadProfile();
  showPosts();
};
</script>

</body>
</html>
