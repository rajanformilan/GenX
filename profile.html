<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>GenX ‚Äî My Profile</title>
<style>
  body { font-family: "Poppins", Arial, sans-serif; background: #f0f2f5; margin:0; padding:0; }
  .profile-container { max-width:600px; margin:20px auto; background:white; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1); overflow:hidden; }
  .cover-photo { width:100%; height:180px; object-fit:cover; }
  .profile-info { text-align:center; padding:15px; margin-top:-60px; }
  .profile-info img { width:110px; height:110px; border-radius:50%; border:4px solid white; }
  .profile-info h2 { margin:10px 0 5px; color:#1877f2; }
  .profile-info p { margin:4px 0; color:#555; }
  .bio { background:#f8f9fa; padding:15px; border-radius:10px; margin:10px; text-align:center; font-style:italic; }
  .btns { text-align:center; margin:15px; }
  .btn { display:inline-block; background:#1877f2; color:white; padding:10px 20px; border-radius:8px; margin:5px; text-decoration:none; font-weight:500; }
  .btn:hover { background:#165ec9; }
  .no-profile { text-align:center; padding:50px; color:#666; }
  .post-section { max-width:600px; margin:20px auto; background:white; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1); padding:15px; }
  textarea { width:100%; border:1px solid #ccc; border-radius:8px; padding:10px; resize:none; font-family:inherit; }
  input[type="file"], select { margin-top:8px; display:block; }
  button { background:#1877f2; color:white; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; }
  button:hover { background:#165ec9; }
  .feed { max-width:600px; margin:20px auto; }
  .post { background:white; margin-bottom:15px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); padding:15px; }
  .post-header { display:flex; justify-content:space-between; font-weight:bold; color:#1877f2; }
  .post-time { color:gray; font-size:12px; }
  .post img, .post video { width:100%; border-radius:10px; margin-top:10px; }
  .actions { margin-top:10px; }
  .actions button { background:none; border:none; color:#555; margin-right:10px; cursor:pointer; }
  .actions button:hover { color:#1877f2; }
  .actions button.liked { color:red; font-weight:bold; }
</style>
</head>
<body>

<!-- Profile -->
<div id="profileSection" class="profile-container" style="display:none;">
  <img id="coverImage" class="cover-photo" src="" alt="Cover Photo">
  <div class="profile-info">
    <img id="profileImage" src="" alt="Profile Picture">
    <h2 id="profileName"></h2>
    <p id="profileEmail"></p>
    <p id="profileGender"></p>
    <p id="profileDob"></p>
  </div>
  <div class="bio" id="profileBio"></div>
  <div class="btns">
    <a href="edit-profile.html" class="btn">Edit Profile</a>
    <a href="index.html" class="btn" style="background:#42b72a;">Go to Home</a>
  </div>
</div>

<div id="noProfile" class="no-profile">
  <h3>No Profile Found</h3>
  <p>Please set up your profile first.</p>
  <a href="authentication.html" class="btn">Create Profile</a>
</div>

<!-- Create Post -->
<div id="postSection" class="post-section" style="display:none;">
  <h3>Create a Post</h3>
  <textarea id="postText" placeholder="What's on your mind?" rows="3"></textarea>
  <input type="file" id="mediaInput" accept="image/*,video/*">
  <select id="privacySelect">
    <option value="public">üåç Public</option>
    <option value="friends">üë• Friends</option>
    <option value="private">üîí Only Me</option>
  </select>
  <button id="postBtn">Post</button>
</div>

<!-- User Posts -->
<div class="feed">
  <h3 style="text-align:center;">Your Posts</h3>
  <div id="myPosts"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js"></script>

<script>
  // üî• Firebase Configuration
  const firebaseConfig = {
    // YOUR_FIREBASE_CONFIG_HERE
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  const savedProfile = JSON.parse(localStorage.getItem("userProfile"));
  const profileSection = document.getElementById("profileSection");
  const noProfile = document.getElementById("noProfile");
  const postSection = document.getElementById("postSection");
  const postText = document.getElementById("postText");
  const mediaInput = document.getElementById("mediaInput");
  const privacySelect = document.getElementById("privacySelect");
  const postBtn = document.getElementById("postBtn");
  const myPosts = document.getElementById("myPosts");

  let username = "";
  let userEmail = "";

  if (savedProfile) {
    profileSection.style.display = "block";
    postSection.style.display = "block";
    noProfile.style.display = "none";

    document.getElementById("coverImage").src = savedProfile.cover || "https://via.placeholder.com/600x150";
    document.getElementById("profileImage").src = savedProfile.avatar || "https://via.placeholder.com/100";
    document.getElementById("profileName").textContent = savedProfile.name || "Unnamed User";
    document.getElementById("profileEmail").textContent = "Email: " + (savedProfile.email || "Not Provided");
    document.getElementById("profileGender").textContent = "Gender: " + (savedProfile.gender || "N/A");
    document.getElementById("profileDob").textContent = "DOB: " + (savedProfile.dob || "N/A");
    document.getElementById("profileBio").textContent = savedProfile.bio || "No bio added yet.";

    username = savedProfile.name;
    userEmail = savedProfile.email;
  }

  // üîπ Create Post with Firebase Storage
  postBtn.addEventListener("click", async () => {
    const text = postText.value.trim();
    const file = mediaInput.files[0];
    const privacy = privacySelect.value;

    if (!text && !file) return alert("Write something or add media!");
    postBtn.disabled = true;

    let mediaURL = "";
    let mediaType = "";

    if (file) {
      const ref = storage.ref(`posts/${Date.now()}-${file.name}`);
      await ref.put(file);
      mediaURL = await ref.getDownloadURL();
      mediaType = file.type;
    }

    await db.collection("posts").add({
      username,
      email: userEmail,
      text,
      media: mediaURL,
      type: mediaType,
      privacy,
      time: new Date().toISOString(),
      likesArray: [],
      comments: []
    });

    postText.value = "";
    mediaInput.value = "";
    postBtn.disabled = false;
    alert("‚úÖ Post uploaded!");
  });

  // üîπ Load user posts
  function loadMyPosts() {
    db.collection("posts")
      .where("email", "==", userEmail)
      .orderBy("time", "desc")
      .onSnapshot(snapshot => {
        myPosts.innerHTML = "";
        if (snapshot.empty) {
          myPosts.innerHTML = '<div class="no-posts">You have not posted yet.</div>';
          return;
        }
        snapshot.forEach(doc => {
          const post = doc.data();
          const div = document.createElement("div");
          div.classList.add("post");

          // Check if current user liked this post
          const liked = post.likesArray && post.likesArray.includes(username);

          div.innerHTML = `
            <div class="post-header">${post.username} ‚Äî <span style="font-size:12px;color:gray;">${post.privacy || 'public'}</span></div>
            <div class="post-time">${new Date(post.time).toLocaleString()}</div>
            <p>${post.text}</p>
            ${post.media ? (post.type.startsWith('image') ? `<img src="${post.media}" alt="Post image">` : `<video controls><source src="${post.media}" type="${post.type}"></video>`) : ''}
            <div class="actions">
              <button class="${liked ? 'liked' : ''}" onclick="likePost('${doc.id}')">${liked ? 'üíî Unlike' : '‚ù§Ô∏è Like'} (${post.likesArray?.length || 0})</button>
              <button onclick="commentPost('${doc.id}')">üí¨ Comment (${post.comments?.length || 0})</button>
            </div>
          `;
          myPosts.appendChild(div);
        });
      });
  }

  // üîπ Like post
  async function likePost(docId) {
    const postRef = db.collection("posts").doc(docId);
    const postDoc = await postRef.get();
    const post = postDoc.data();
    const likesArray = post.likesArray || [];
    const index = likesArray.indexOf(username);
    if (index === -1) likesArray.push(username);
    else likesArray.splice(index, 1);
    await postRef.update({ likesArray });
  }

  // üîπ Comment post
  async function commentPost(docId) {
    const commentText = prompt("Write your comment:");
    if (!commentText) return;
    const postRef = db.collection("posts").doc(docId);
    const postDoc = await postRef.get();
    const post = postDoc.data();
    const comments = post.comments || [];
    comments.push({ user: username, text: commentText, time: new Date().toISOString() });
    await postRef.update({ comments });
    alert("Comment added!");
  }

  if (userEmail) loadMyPosts();
</script>
</body>
</html>
