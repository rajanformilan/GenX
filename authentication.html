<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GenX — Profile Setup</title>
<style>
  body {font-family: Arial; background:#f0f2f5; margin:0;}
  .container {max-width:600px; margin:30px auto; background:white; padding:20px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1);}
  h2 {color:#1877f2;}
  input,select,textarea,button{width:100%;margin:8px 0;padding:10px;border-radius:8px;border:1px solid #ccc;box-sizing:border-box;font-size:14px;}
  button{background:#1877f2;color:white;border:none;cursor:pointer;}
  button:hover{background:#145cce;}
  .step{display:none;}
  .step.active{display:block;}
  .profile-display{text-align:center;}
  .cover-display{width:100%;height:150px;object-fit:cover;border-radius:10px;}
  .profile-display img{border-radius:10px;margin:10px;}
</style>
</head>
<body>
<div class="container">
  <!-- Step 1 -->
  <div id="step1" class="step active">
    <h2>Step 1 – Basic Info</h2>
    <input type="text" id="name" placeholder="Full Name" required>
    <input type="email" id="email" placeholder="Email" required>
    <select id="gender" required>
      <option value="">Select Gender</option>
      <option>Male</option><option>Female</option><option>Other</option>
    </select>
    <input type="date" id="dob" required>
    <button id="next1">Next →</button>
  </div>

  <!-- Step 2 -->
  <div id="step2" class="step">
    <h2>Step 2 – Profile & Cover</h2>
    <label>Profile Picture:</label>
    <input type="file" id="profilePic" accept="image/*">
    <label>Cover Photo:</label>
    <input type="file" id="coverPic" accept="image/*">
    <textarea id="bio" placeholder="Write a short bio..." rows="3"></textarea>
    <button id="prev1">← Back</button>
    <button id="next2">Next →</button>
  </div>

  <!-- Step 3 -->
  <div id="step3" class="step">
    <h2>Step 3 – Review & Save</h2>
    <div class="profile-display">
      <img id="displayCover" class="cover-display" src="https://via.placeholder.com/600x150" alt="cover">
      <img id="displayProfile" src="https://via.placeholder.com/100" width="100" height="100" alt="profile">
      <h3 id="displayName"></h3>
      <p id="displayEmail"></p>
      <p id="displayGender"></p>
      <p id="displayDob"></p>
      <p id="displayBio"></p>
    </div>
    <button id="editBtn">← Edit</button>
    <button id="saveBtn">Save Profile</button>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyAyMhgLjQg9zU1Tq2pFVmRiF_UiOBqPlj0",
  authDomain:"genx-7a5b3.firebaseapp.com",
  projectId:"genx-7a5b3",
  storageBucket:"genx-7a5b3.firebasestorage.app",
  messagingSenderId:"1293731877",
  appId:"1:1293731877:web:a330360ade1db5e68897cc"
};
firebase.initializeApp(firebaseConfig);

// elements
const step1=document.getElementById("step1");
const step2=document.getElementById("step2");
const step3=document.getElementById("step3");
const next1=document.getElementById("next1");
const prev1=document.getElementById("prev1");
const next2=document.getElementById("next2");
const editBtn=document.getElementById("editBtn");
const saveBtn=document.getElementById("saveBtn");
const nameField=document.getElementById("name");
const emailField=document.getElementById("email");
const genderField=document.getElementById("gender");
const dobField=document.getElementById("dob");
const profilePic=document.getElementById("profilePic");
const coverPic=document.getElementById("coverPic");
const bio=document.getElementById("bio");

// display
const dName=document.getElementById("displayName");
const dEmail=document.getElementById("displayEmail");
const dGender=document.getElementById("displayGender");
const dDob=document.getElementById("displayDob");
const dProfile=document.getElementById("displayProfile");
const dCover=document.getElementById("displayCover");
const dBio=document.getElementById("displayBio");

let profileData={};

// Step1→2
next1.onclick=()=>{
  if(!nameField.value||!emailField.value||!genderField.value||!dobField.value){
    alert("Please fill all fields first!");
    return;
  }
  profileData={
    name:nameField.value,
    email:emailField.value,
    gender:genderField.value,
    dob:dobField.value
  };
  step1.classList.remove("active");
  step2.classList.add("active");
};

// Back to Step1
prev1.onclick=()=>{
  step2.classList.remove("active");
  step1.classList.add("active");
};

// Step2→3
next2.onclick=()=>{
  profileData.bio=bio.value||"";
  Promise.all([
    uploadImage(profilePic,"profiles"),
    uploadImage(coverPic,"covers")
  ]).then(([pUrl,cUrl])=>{
    profileData.avatar=pUrl||"https://via.placeholder.com/100";
    profileData.cover=cUrl||"https://via.placeholder.com/600x150";
    showReview();
    step2.classList.remove("active");
    step3.classList.add("active");
  });
};

// Upload helper
function uploadImage(fileInput,folder){
  return new Promise(resolve=>{
    if(fileInput.files.length===0) return resolve(null);
    const ref=firebase.storage().ref(`${folder}/${Date.now()}_${fileInput.files[0].name}`);
    ref.put(fileInput.files[0]).then(s=>s.ref.getDownloadURL()).then(url=>resolve(url)).catch(()=>resolve(null));
  });
}

// Show review
function showReview(){
  dName.textContent=profileData.name;
  dEmail.textContent="Email: "+profileData.email;
  dGender.textContent="Gender: "+profileData.gender;
  dDob.textContent="DOB: "+profileData.dob;
  dBio.textContent=profileData.bio;
  dProfile.src=profileData.avatar;
  dCover.src=profileData.cover;
}

// Edit
editBtn.onclick=()=>{
  step3.classList.remove("active");
  step1.classList.add("active");
};

// Save + Redirect
saveBtn.onclick=()=>{
  firebase.database().ref("users/"+Date.now()).set(profileData)
  .then(()=>{
    alert("Profile saved successfully!");
    window.location.href="profile.html"; // ✅ redirect after save
  })
  .catch(err=>alert(err.message));
};
</script>
</body>
</html>
