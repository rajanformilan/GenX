<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GenX — Signup / Login</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; }
.container { max-width: 600px; margin: 30px auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
h2 { color: #1877f2; }
input, select, textarea, button { width: 100%; margin: 8px 0; padding: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; font-size: 14px; }
button { background: #1877f2; color: white; border: none; cursor: pointer; }
button:hover { background: #165ec9; }
.step { display: none; }
.step.active { display: block; }
.profile-display { text-align: center; }
.profile-display img { width: 100px; height: 100px; border-radius: 50%; margin: 10px; }
.cover-display { width: 100%; height: 150px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; }
.optional-login { text-align:center; margin-top:10px; font-size:14px; }
.optional-login a { color: #1877f2; text-decoration:none; }
.optional-login a:hover { text-decoration:underline; }
.login-form { display:none; }
</style>
</head>
<body>

<div class="container">
  <!-- Step 1: Basic Info -->
  <div class="step active" id="step1">
    <h2>Step 1: Basic Info</h2>
    <input type="text" id="firstName" placeholder="Full Name" required>
    <input type="email" id="email" placeholder="Email" required>
    <select id="gender" required>
      <option value="">Select Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select>
    <select id="marital" required>
      <option value="">Marital Status</option>
      <option value="Single">Single</option>
      <option value="Married">Married</option>
    </select>
    <input type="text" id="location" placeholder="Location (City, Country)" required>
    <input type="date" id="dob" required>
    <button id="next1">Next</button>
    <p class="optional-login">Already have an account? <a href="#" id="loginLink">Login here</a></p>
  </div>

  <!-- Step 2: Avatar, Cover, Bio -->
  <div class="step" id="step2">
    <h2>Step 2: Profile & Cover</h2>
    <label>Profile Picture:</label>
    <input type="file" id="profilePic" accept="image/*">
    <label>Cover Photo:</label>
    <input type="file" id="coverPic" accept="image/*">
    <label>Bio:</label>
    <textarea id="bio" placeholder="Write a short bio..." rows="3"></textarea>
    <button id="next2">Next</button>
  </div>

  <!-- Step 3: Review & Save -->
  <div class="step" id="step3">
    <h2>Step 3: Review & Save</h2>
    <div class="profile-display">
      <img id="displayProfile" src="https://via.placeholder.com/100" alt="Profile">
      <h3 id="displayName"></h3>
      <p id="displayEmail"></p>
      <p id="displayGender"></p>
      <p id="displayMarital"></p>
      <p id="displayLocation"></p>
      <p id="displayDob"></p>
      <img id="displayCover" class="cover-display" src="https://via.placeholder.com/600x150" alt="Cover">
      <p id="displayBio"></p>
    </div>
    <button id="editBtn">Edit Info</button>
    <button id="saveBtn">Save Profile</button>
  </div>

  <!-- Login Form -->
  <div class="step login-form" id="loginForm">
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Enter your email" required>
    <button id="loginBtn">Login</button>
    <p class="optional-login">Don't have an account? <a href="#" id="backSignup">Signup</a></p>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js"></script>

<script>
const firebaseConfig = { /* YOUR_FIREBASE_CONFIG_HERE */ };
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// Elements
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const step3 = document.getElementById('step3');
const loginForm = document.getElementById('loginForm');

const next1 = document.getElementById('next1');
const next2 = document.getElementById('next2');
const editBtn = document.getElementById('editBtn');
const saveBtn = document.getElementById('saveBtn');
const loginLink = document.getElementById('loginLink');
const backSignup = document.getElementById('backSignup');
const loginBtn = document.getElementById('loginBtn');

const firstName = document.getElementById('firstName');
const email = document.getElementById('email');
const gender = document.getElementById('gender');
const marital = document.getElementById('marital');
const locationInput = document.getElementById('location');
const dob = document.getElementById('dob');
const profilePic = document.getElementById('profilePic');
const coverPic = document.getElementById('coverPic');
const bio = document.getElementById('bio');

const displayName = document.getElementById('displayName');
const displayEmail = document.getElementById('displayEmail');
const displayGender = document.getElementById('displayGender');
const displayMarital = document.getElementById('displayMarital');
const displayLocation = document.getElementById('displayLocation');
const displayDob = document.getElementById('displayDob');
const displayProfile = document.getElementById('displayProfile');
const displayCover = document.getElementById('displayCover');
const displayBio = document.getElementById('displayBio');

const loginEmail = document.getElementById('loginEmail');

let profileData = {};

// Step 1 → Step 2
next1.addEventListener('click', () => {
  if(!firstName.value || !email.value || !gender.value || !dob.value || !marital.value || !locationInput.value){
    alert('Please fill all fields!');
    return;
  }
  profileData.name = firstName.value;
  profileData.email = email.value;
  profileData.gender = gender.value;
  profileData.marital = marital.value;
  profileData.location = locationInput.value;
  profileData.dob = dob.value;
  step1.classList.remove('active');
  step2.classList.add('active');
});

// Step 2 → Step 3
next2.addEventListener('click', () => {
  profileData.bio = bio.value || '';
  const profileFile = profilePic.files[0];
  const coverFile = coverPic.files[0];

  const readFile = (file) => new Promise(resolve => {
    if(!file) return resolve(null);
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.readAsDataURL(file);
  });

  Promise.all([readFile(profileFile), readFile(coverFile)]).then(([avatar, cover]) => {
    profileData.avatar = avatar || "https://via.placeholder.com/100";
    profileData.cover = cover || "https://via.placeholder.com/600x150";
    showReview();
    step2.classList.remove('active');
    step3.classList.add('active');
  });
});

function showReview(){
  displayName.textContent = profileData.name;
  displayEmail.textContent = "Email: " + profileData.email;
  displayGender.textContent = "Gender: " + profileData.gender;
  displayMarital.textContent = "Marital: " + profileData.marital;
  displayLocation.textContent = "Location: " + profileData.location;
  displayDob.textContent = "DOB: " + profileData.dob;
  displayProfile.src = profileData.avatar;
  displayCover.src = profileData.cover;
  displayBio.textContent = profileData.bio;
}

// Edit button
editBtn.addEventListener('click', () => {
  step3.classList.remove('active');
  step1.classList.add('active');
  firstName.value = profileData.name;
  email.value = profileData.email;
  gender.value = profileData.gender;
  marital.value = profileData.marital;
  locationInput.value = profileData.location;
  dob.value = profileData.dob;
  bio.value = profileData.bio;
});

// Save profile to Firebase
saveBtn.addEventListener('click', async () => {
  saveBtn.disabled = true;
  let avatarURL = profileData.avatar;
  let coverURL = profileData.cover;

  if(profilePic.files[0]){
    const ref = storage.ref("avatars/" + Date.now() + "-" + profilePic.files[0].name);
    await ref.put(profilePic.files[0]);
    avatarURL = await ref.getDownloadURL();
  }

  if(coverPic.files[0]){
    const refCover = storage.ref("covers/" + Date.now() + "-" + coverPic.files[0].name);
    await refCover.put(coverPic.files[0]);
    coverURL = await refCover.getDownloadURL();
  }

  await db.collection("users").doc(profileData.email).set({
    name: profileData.name,
    email: profileData.email,
    gender: profileData.gender,
    marital: profileData.marital,
    location: profileData.location,
    dob: profileData.dob,
    bio: profileData.bio,
    avatar: avatarURL,
    cover: coverURL,
    time: new Date().toISOString()
  });

  alert('✅ Profile saved successfully!');
  localStorage.setItem('userProfile', JSON.stringify(profileData));
  saveBtn.disabled = false;
});

// Show login form
loginLink.addEventListener('click', (e) => {
  e.preventDefault();
  step1.classList.remove('active');
  step2.classList.remove('active');
  step3.classList.remove('active');
  loginForm.classList.add('active');
});

backSignup.addEventListener('click', (e) => {
  e.preventDefault();
  loginForm.classList.remove('active');
  step1.classList.add('active');
});

// Login user
loginBtn.addEventListener('click', async () => {
  const email = loginEmail.value.trim();
  if(!email) return alert("Enter your email");
  const doc = await db.collection("users").doc(email).get();
  if(doc.exists){
    const user = doc.data();
    localStorage.setItem('userProfile', JSON.stringify(user));
    alert("Login successful!");
    window.location.href = "profile.html";
  } else {
    alert("No account found with this email!");
  }
});
</script>
</body>
</html>
